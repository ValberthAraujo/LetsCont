import{r as c,u as K,j as t,c as W,g as O}from"./index-0fLGo3W8.js";const V="_checkoutPage_1nh09_5",Y="_container_1nh09_19",z="_checkoutSection_1nh09_41",H="_title_1nh09_49",J="_checkoutContent_1nh09_65",X="_checkoutForm_1nh09_83",Z="_formGroup_1nh09_83",ee="_label_1nh09_91",te="_input_1nh09_105",ae="_quantityPicker_1nh09_141",ne="_quantityLabel_1nh09_155",oe="_quantityControls_1nh09_165",se="_quantityBtn_1nh09_181",re="_quantityInput_1nh09_211",ce="_total_1nh09_233",ie="_totalPrice_1nh09_249",le="_actionButtons_1nh09_261",de="_primaryButton_1nh09_273",ue="_backButton_1nh09_311",pe="_statusMessage_1nh09_337",me="_success_1nh09_345",_e="_error_1nh09_347",he="_statusBadge_1nh09_351",xe="_badgePaid_1nh09_361",ye="_badgePending_1nh09_363",ge="_badgeFailed_1nh09_365",fe="_paymentBox_1nh09_371",be="_providerTag_1nh09_387",Pe="_qrWrap_1nh09_389",Ne="_qrImage_1nh09_391",ve="_pixBox_1nh09_395",ke="_pixTextarea_1nh09_397",Be="_copyBtn_1nh09_399",Ce="_paymentLinkBox_1nh09_423",je="_expiresNote_1nh09_425",e={checkoutPage:V,container:Y,checkoutSection:z,title:H,checkoutContent:J,checkoutForm:X,formGroup:Z,label:ee,input:te,quantityPicker:ae,quantityLabel:ne,quantityControls:oe,quantityBtn:se,quantityInput:re,total:ce,totalPrice:ie,actionButtons:le,primaryButton:de,backButton:ue,statusMessage:pe,success:me,error:_e,statusBadge:he,badgePaid:xe,badgePending:ye,badgeFailed:ge,paymentBox:fe,providerTag:be,qrWrap:Pe,qrImage:Ne,pixBox:ve,pixTextarea:ke,copyBtn:Be,paymentLinkBox:Ce,expiresNote:je},C={},qe="https://sdk.mercadopago.com/js/v2";function we(i){return typeof i=="string"&&(i.startsWith("PK-")||i.startsWith("TEST-"))}const Se=(C?.VITE_MP_PUBLIC_KEY||C?.VITE_MERCADOPAGO_PUBLIC_KEY||C?.VITE_PUBLIC_KEY||"").trim();let P;function Te(){return typeof window<"u"&&window.MercadoPago?Promise.resolve(window.MercadoPago):P||(P=new Promise((i,p)=>{try{const o=document.createElement("script");o.src=qe,o.async=!0,o.onload=()=>i(window.MercadoPago),o.onerror=()=>p(new Error("Falha ao carregar SDK do Mercado Pago")),document.head.appendChild(o)}catch(o){p(o)}}),P)}async function Ie(i,{locale:p="pt-BR"}={}){const o=Se;if(!i||!we(o))return!1;try{return await Te(),new window.MercadoPago(o,{locale:p}).checkout({preference:{id:i},autoOpen:!0}),!0}catch{return!1}}function Fe(){const[o,m]=c.useState(1),[j,I]=c.useState(""),[E,L]=c.useState(""),[q,F]=c.useState(""),[N,w]=c.useState(!1),[v,l]=c.useState({type:"",text:"",paymentUrl:""}),[s,M]=c.useState({provider:"",paymentUrl:"",qrSrc:"",pixCode:"",expiresAt:"",orderId:""}),[Q,S]=c.useState(!1),[y,k]=c.useState({code:"",label:""}),d=c.useRef(null);c.useEffect(()=>()=>{d.current&&(clearTimeout(d.current),d.current=null)},[]);const g=()=>{d.current&&(clearTimeout(d.current),d.current=null)},B=(n,a=Date.now()+5*6e4)=>{if(!n)return;const _=async()=>{try{const r=await O(n),f=(r?.status||r?.payment_status||r?.state||"").toLowerCase();if(["paid","approved","completed","settled","succeeded","success"].includes(f)){k({code:"paid",label:"Pagamento confirmado ✔"}),l({type:"success",text:"Pagamento aprovado! Obrigado por participar."}),g();return}if(["expired","canceled","cancelled","failed","rejected","error"].includes(f)){k({code:"failed",label:"Pagamento não aprovado"}),l({type:"error",text:r?.detail||"Pagamento não aprovado. Tente novamente."}),g();return}k({code:"pending",label:"Aguardando pagamento..."}),Date.now()<a?d.current=setTimeout(_,4e3):g()}catch{Date.now()<a?d.current=setTimeout(_,5e3):g()}};_()},R=K(),U=()=>m(n=>n>1?n-1:1),A=()=>m(n=>n<100?n+1:100),$=n=>{let a=parseInt(n.target.value);(isNaN(a)||a<1)&&(a=1),a>100&&(a=100),m(a)},D=async()=>{if(!N){l({type:"",text:"",paymentUrl:""}),w(!0);try{const n={nome:j,email:q,valor:Number(T),quantidade:Number(o)},a=await W(n),_=a?.provider||a?.gateway||"",r=a?.payment_url||a?.init_point||a?.url||"",f=a?.expires_at||a?.expiration||"";let h="",x="";const b=a?.qr_code_base64||a?.qr_code||"";b&&(h=b.startsWith("data:image")?b:`data:image/png;base64,${b}`),x=a?.copy_and_paste||a?.pix_code||a?.copia_cola||a?.pixCopiaCola||"";const u=a?.order_id||a?.id||a?.payment_id||a?.preference_id||a?.transaction_id||a?.reference||"";M({provider:_,paymentUrl:r,qrSrc:h,pixCode:x,expiresAt:f,orderId:u}),r&&!h&&!x?(l({type:"success",text:"Redirecionando para o pagamento...",paymentUrl:r}),window.open(r,"_blank")):!r&&!h&&!x&&a?.preference_id?await Ie(a.preference_id)?(l({type:"success",text:"Abrindo checkout do Mercado Pago..."}),u&&B(u)):l({type:"error",text:"Não foi possível abrir o checkout. Tente pelo link se disponível."}):x||h?(l({type:"success",text:"Pedido criado. Pague usando o QR Code ou o código abaixo."}),u&&B(u)):(l({type:"success",text:a?.detail||"Pedido criado com sucesso. Verifique seu email."}),u&&B(u))}catch(n){l({type:"error",text:n?.message||"Falha ao iniciar pagamento. Tente novamente."})}finally{w(!1)}}},G=()=>{R("/rifa")},T=(o*4.99).toFixed(2);return t.jsx("main",{className:e.checkoutPage,children:t.jsx("section",{className:e.checkoutSection,children:t.jsxs("div",{className:e.container,children:[t.jsx("h1",{className:e.title,children:"Finalizar Compra"}),t.jsx("div",{className:e.checkoutContent,children:t.jsxs("form",{className:e.checkoutForm,onSubmit:n=>n.preventDefault(),children:[t.jsxs("div",{className:e.formGroup,children:[t.jsx("label",{htmlFor:"name",className:e.label,children:"Nome Completo *"}),t.jsx("input",{type:"text",id:"name",className:e.input,placeholder:"Seu nome",value:j,onChange:n=>I(n.target.value),required:!0})]}),t.jsxs("div",{className:e.formGroup,children:[t.jsx("label",{htmlFor:"tel",className:e.label,children:"Número de Telefone *"}),t.jsx("input",{type:"tel",id:"tel",className:e.input,placeholder:"Seu número",value:E,onChange:n=>L(n.target.value),required:!0})]}),t.jsxs("div",{className:e.formGroup,children:[t.jsx("label",{htmlFor:"email",className:e.label,children:"Email *"}),t.jsx("input",{type:"email",id:"email",className:e.input,placeholder:"seu@email.com",value:q,onChange:n=>F(n.target.value),required:!0})]}),t.jsxs("div",{className:e.quantityPicker,children:[t.jsx("span",{className:e.quantityLabel,children:"Quantidade:"}),t.jsxs("div",{className:e.quantityControls,children:[t.jsx("button",{type:"button",className:e.quantityBtn,onClick:U,children:"-"}),t.jsx("input",{type:"number",className:e.quantityInput,value:o,min:"1",max:100,onChange:$}),t.jsx("button",{type:"button",className:e.quantityBtn,onClick:A,children:"+"})]})]}),t.jsxs("div",{className:e.total,children:["Total: ",t.jsxs("span",{className:e.totalPrice,children:["R$",T]})]}),t.jsxs("div",{className:e.actionButtons,children:[t.jsx("button",{type:"button",className:e.primaryButton,onClick:D,disabled:N,children:N?"Processando...":"Pagar Agora"}),t.jsx("button",{type:"button",className:`${e.primaryButton} ${e.backButton}`,onClick:G,children:"Voltar"}),v.text&&t.jsx("div",{className:`${e.statusMessage} ${v.type==="success"?e.success:e.error}`,children:v.text})]}),(s.qrSrc||s.pixCode||s.paymentUrl)&&t.jsxs("div",{className:e.paymentBox,children:[s.provider&&t.jsxs("div",{className:e.providerTag,children:["Gateway: ",s.provider]}),s.qrSrc&&t.jsx("div",{className:e.qrWrap,children:t.jsx("img",{src:s.qrSrc,alt:"QR Code para pagamento",className:e.qrImage})}),s.pixCode&&t.jsxs("div",{className:e.pixBox,children:[t.jsx("label",{className:e.label,children:"Código Pix (copia e cola)"}),t.jsx("textarea",{className:`${e.input} ${e.pixTextarea}`,readOnly:!0,value:s.pixCode,rows:4}),t.jsx("button",{type:"button",className:e.copyBtn,onClick:async()=>{try{await navigator.clipboard.writeText(s.pixCode),S(!0),setTimeout(()=>S(!1),1500)}catch{}},children:Q?"Copiado!":"Copiar código Pix"})]}),s.paymentUrl&&t.jsx("div",{className:e.paymentLinkBox,children:t.jsx("a",{href:s.paymentUrl,target:"_blank",rel:"noreferrer",className:e.primaryButton,children:"Abrir Checkout"})}),s.expiresAt&&t.jsxs("div",{className:e.expiresNote,children:["Expira em: ",new Date(s.expiresAt).toLocaleString()]}),y.label&&t.jsx("div",{className:`${e.statusBadge} ${y.code==="paid"?e.badgePaid:y.code==="failed"?e.badgeFailed:e.badgePending}`,children:y.label})]})]})})]})})})}export{Fe as Checkout};
