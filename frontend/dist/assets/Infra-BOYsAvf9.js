import{a as C,r as n,j as e,f as S,h as b}from"./index-0fLGo3W8.js";import{s as a}from"./admin.module-BibDxh5X.js";function k(){const{user:h,token:o}=C(),l=n.useMemo(()=>!!h?.is_superuser,[h]),[m,p]=n.useState(!1),[c,d]=n.useState(""),[f,g]=n.useState(0),[x,u]=n.useState([]),[j,N]=n.useState({}),y=async s=>{if(!(!o||!l||!s?.id||s?.respondido)){N(r=>({...r,[s.id]:!0})),d("");try{const r=await b(o,s.id,"Respondido pelo painel");u(t=>t.map(i=>i.id===s.id?r:i))}catch(r){d(r?.message||"Falha ao marcar como respondido")}finally{N(r=>{const t={...r};return delete t[s.id],t})}}};return n.useEffect(()=>{let s=!0;async function r(){if(!(!o||!l)){p(!0),d("");try{const t=await S(o);if(!s)return;g(Number(t?.count||(Array.isArray(t)?t.length:0)));const i=Array.isArray(t)?t:Array.isArray(t?.data)?t.data:[];u(i)}catch(t){if(!s)return;d(t?.message||"Falha ao carregar contatos")}finally{s&&p(!1)}}}return r(),()=>{s=!1}},[o,l]),e.jsxs("div",{className:a.loginCard,children:[e.jsx("h2",{children:"Contatos do Site"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total de contatos:"})," ",m?"Carregando...":f]}),c&&e.jsx("p",{className:a.error,children:c}),!m&&!c&&e.jsx("div",{className:a.tableWrap,children:e.jsxs("table",{className:a.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:a.th,children:"Criado em"}),e.jsx("th",{className:a.th,children:"Nome"}),e.jsx("th",{className:a.th,children:"Email"}),e.jsx("th",{className:a.th,children:"Mensagem"}),e.jsx("th",{className:a.th,children:"Respondido"}),e.jsx("th",{className:a.th,children:"Respondido em"}),e.jsx("th",{className:a.th,children:"Ação"})]})}),e.jsxs("tbody",{children:[x.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:a.td,children:s.created_at?new Date(s.created_at).toLocaleString():"-"}),e.jsx("td",{className:a.td,children:s.nome}),e.jsx("td",{className:a.td,children:s.email}),e.jsx("td",{className:a.td,children:s.mensagem}),e.jsx("td",{className:a.td,children:s.respondido?"Sim":"Não"}),e.jsx("td",{className:a.td,children:s.respondido_em?new Date(s.respondido_em).toLocaleString():"-"}),e.jsx("td",{className:a.td,children:e.jsxs("label",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",checked:!!s.respondido,disabled:!!s.respondido||!!j[s.id],onChange:()=>y(s),"aria-label":"Marcar como respondido"}),e.jsx("span",{style:{opacity:s.respondido?.6:1},children:j[s.id]?"Marcando...":s.respondido?"Respondido":"Marcar respondido"})]})})]},s.id)),x.length===0&&e.jsx("tr",{children:e.jsx("td",{className:`${a.td} ${a.tdCenter}`,colSpan:7,children:"Nenhum contato encontrado."})})]})]})})]})}export{k as PanelInfra,k as default};
