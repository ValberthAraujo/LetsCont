import{a as ce,r as o,j as t,k as X,l as de,m as ie,n as ue,o as me}from"./index-0fLGo3W8.js";import{s as a}from"./admin.module-BibDxh5X.js";function xe(){const{token:l,user:fe}=ce(),[v,x]=o.useState(""),[he,b]=o.useState(null),[C,D]=o.useState(""),[g,I]=o.useState(1),[w,E]=o.useState(""),[S,T]=o.useState(""),[j,p]=o.useState([]),[Y,B]=o.useState(!1),[G,M]=o.useState(""),[z,c]=o.useState(""),[R,Q]=o.useState(null),[d,f]=o.useState({nome:"",quantidade:1,preco:"",descricao:""}),[u,h]=o.useState(!1),[Z,N]=o.useState(!1),K=240,[O,ee]=o.useState([]),[te,U]=o.useState(!1),[V,_]=o.useState(""),F=o.useRef(null),k=o.useRef(null);o.useEffect(()=>{if(!u)return;const e=s=>{s.key==="Escape"&&h(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[u]),o.useEffect(()=>{if(u&&F.current)try{F.current.focus()}catch{}},[u]),o.useEffect(()=>{if(!u)return;const e=document.body.style.overflow;document.body.style.overflow="hidden";const s=()=>k.current?Array.from(k.current.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])')).filter(n=>!n.hasAttribute("disabled")):[],r=n=>{if(n.key!=="Tab")return;const m=s();if(!m.length)return;const i=m[0],y=m[m.length-1];n.shiftKey?document.activeElement===i&&(n.preventDefault(),y.focus()):document.activeElement===y&&(n.preventDefault(),i.focus())};return document.addEventListener("keydown",r,!0),()=>{document.body.style.overflow=e,document.removeEventListener("keydown",r,!0)}},[u]),o.useEffect(()=>{let e=!0;async function s(){if(l){U(!0),_("");try{const r=await de(l);if(!e)return;const n=Array.isArray(r)?r:Array.isArray(r?.data)?r.data:[];ee(n)}catch(r){if(!e)return;_(r?.message||"Falha ao carregar receitas das rifas")}finally{e&&U(!1)}}}return s(),()=>{e=!1}},[l]);const A=o.useMemo(()=>{const e=Number(String(w).replace(",","."));return Number.isFinite(e)?e:0},[w]);o.useEffect(()=>{let e=!0;async function s(){if(l){B(!0),M("");try{const r=await ie(l);if(!e)return;const n=Array.isArray(r)?r:Array.isArray(r?.data)?r.data:[];p(n)}catch(r){if(!e)return;M(r?.message||"Falha ao carregar produtos")}finally{e&&B(!1)}}}return s(),()=>{e=!1}},[l]);const H=e=>{if(b(e||null),!e){x("");return}const s=new FileReader;s.onload=()=>x(String(s.result||"")),s.readAsDataURL(e)},ae=e=>{const s=e.target.files?.[0];H(s)},se=async()=>{if(c(""),!C.trim()){c("Informe o nome do produto");return}if(!A||A<=0){c("Informe um preço válido");return}if(!g||g<=0){c("Informe uma quantidade válida");return}try{const e=await ue(l,{nome:C.trim(),quantidade:Number(g),preco:Number(A),foto:v||null,descricao:(S||"").trim()||null});p(s=>[e,...s])}catch(e){c(e?.message||"Falha ao criar produto");return}D(""),I(1),E(""),T(""),b(null),x(""),h(!1)},re=e=>{Q(e.id),f({nome:e.nome,quantidade:e.quantidade,preco:String(Number(e.preco||0).toFixed(2)),descricao:e.descricao||""})},P=()=>{Q(null),f({nome:"",quantidade:1,preco:"",descricao:""})},oe=async e=>{const s=Number(d.quantidade),r=Number(String(d.preco).replace(",","."));if(!(!d.nome.trim()||!s||s<=0||!r||r<=0)){try{const n=await X(l,e,{nome:d.nome.trim(),quantidade:s,preco:r,descricao:(d.descricao||"").trim()});p(m=>m.map(i=>i.id===e?n:i))}catch(n){c(n?.message||"Falha ao salvar alterações");return}P()}},ne=async e=>{try{await me(l,e),p(s=>s.filter(r=>r.id!==e)),R===e&&P()}catch(s){c(s?.message||"Falha ao deletar produto")}},le=new Set(["paid","approved","completed","settled","succeeded","success"]),q=o.useMemo(()=>O.reduce((e,s)=>e+(le.has(String(s?.status||"").toLowerCase())?Number(s?.valor||0):0),0),[O]),L=o.useMemo(()=>j.reduce((e,s)=>e+Number(s?.preco||0)*Number(s?.quantidade||0),0),[j]),J=o.useMemo(()=>q-L,[q,L]),$=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});return t.jsxs("div",{className:a.loginCard,children:[t.jsx("h2",{children:"Painel LetsCoffe"}),t.jsx("p",{children:"Cadastre itens com foto, nome, quantidade e preço."}),t.jsxs("div",{className:a.statsRow,children:[t.jsxs("div",{className:a.statCard,children:[t.jsxs("div",{className:a.statTitle,children:["Receita de Rifas ",te?"(carregando...)":""]}),t.jsx("div",{className:`${a.statValue} ${a.statPositive}`,children:$(q)}),V&&t.jsx("div",{className:a.error,children:V})]}),t.jsxs("div",{className:a.statCard,children:[t.jsx("div",{className:a.statTitle,children:"Gastos Let's Coffe"}),t.jsx("div",{className:`${a.statValue} ${a.statNegative}`,children:$(L)})]}),t.jsxs("div",{className:a.statCard,children:[t.jsx("div",{className:a.statTitle,children:"Resultado Líquido"}),t.jsx("div",{className:a.statValue,style:{color:J>=0?"var(--color-success)":"var(--detail-color)"},children:$(J)})]})]}),!u&&t.jsx("div",{className:a.cardActions,style:{marginBottom:"0.75rem"},children:t.jsx("div",{className:a.btnRow,children:t.jsx("button",{type:"button",className:`${a.btn} ${a.btnPrimary}`,onClick:()=>h(!0),children:"Adicionar produto"})})}),u&&t.jsx("div",{className:a.modalOverlay,role:"dialog","aria-modal":"true",onClick:e=>{e.currentTarget===e.target&&h(!1)},children:t.jsxs("div",{ref:k,className:`${a.modalContent} ${a.formCard}`,"aria-labelledby":"letscoffe-modal-title",children:[t.jsxs("div",{className:a.modalHeader,children:[t.jsx("div",{id:"letscoffe-modal-title",className:a.modalTitle,children:"Adicionar produto"}),t.jsx("button",{type:"button",className:a.closeBtn,"aria-label":"Fechar",onClick:()=>h(!1),children:"×"})]}),t.jsxs("div",{className:a.formGrid,children:[t.jsxs("div",{children:[t.jsx("div",{className:`${a.dropzone} ${Z?a.dropActive:""}`,onClick:()=>document.getElementById("letscoffe-upload")?.click(),onDragOver:e=>{e.preventDefault(),N(!0)},onDragEnter:()=>N(!0),onDragLeave:()=>N(!1),onDrop:e=>{e.preventDefault(),N(!1);const s=e.dataTransfer?.files?.[0];s&&H(s)},children:v?t.jsx("img",{src:v,alt:"Pré-visualização",className:a.previewImage}):t.jsx("div",{className:a.dropLabel,children:"Clique ou arraste a foto do produto"})}),t.jsx("input",{id:"letscoffe-upload",type:"file",accept:"image/*",onChange:ae,style:{display:"none"}}),v&&t.jsx("div",{className:a.helpText,children:t.jsx("button",{type:"button",className:a.btn,onClick:()=>{x(""),b(null)},children:"Remover foto"})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:a.formGroup,children:[t.jsx("label",{children:"Nome do Produto"}),t.jsx("input",{ref:F,type:"text",value:C,onChange:e=>D(e.target.value),placeholder:"Ex.: Café Coado"})]}),t.jsxs("div",{className:a.fieldRow,children:[t.jsxs("div",{className:a.formGroup,children:[t.jsx("label",{children:"Quantidade"}),t.jsx("input",{type:"number",min:"1",value:g,onChange:e=>I(Math.max(1,Number(e.target.value||1)))})]}),t.jsxs("div",{className:a.formGroup,children:[t.jsx("label",{children:"Preço (R$)"}),t.jsx("input",{type:"text",value:w,onChange:e=>E(e.target.value),placeholder:"Ex.: 9,90",onBlur:e=>{const s=Number(String(e.target.value).replace(",","."));Number.isFinite(s)&&s>0&&E(s.toFixed(2).replace(".",","))}})]})]}),t.jsxs("div",{className:a.formGroup,children:[t.jsx("label",{children:"Descrição do Produto"}),t.jsx("textarea",{rows:3,value:S,maxLength:K,onChange:e=>T(e.target.value),placeholder:"Breve descrição (ex.: ingredientes, tamanho, observações)"}),t.jsxs("div",{className:a.counter,children:[S.length,"/",K]})]}),z&&t.jsx("p",{className:a.error,children:z}),t.jsxs("div",{className:a.formActions,children:[t.jsx("button",{type:"button",className:a.btn,onClick:()=>{h(!1),c("")},children:"Cancelar"}),t.jsx("button",{type:"button",className:`${a.btn} ${a.btnPrimary}`,onClick:se,children:"Adicionar"})]})]})]})]})}),G&&t.jsx("div",{className:a.error,children:G}),Y&&t.jsx("div",{className:a.muted,children:"Carregando produtos..."}),j.length>0&&t.jsx("div",{className:a.cardsGrid,children:j.map(e=>t.jsxs("div",{className:a.cardItem,children:[t.jsxs("div",{className:a.cardImage,onClick:()=>{const s=document.getElementById(`foto-${e.id}`);s&&s.click()},role:"button",tabIndex:0,onKeyDown:s=>{if(s.key==="Enter"||s.key===" "){const r=document.getElementById(`foto-${e.id}`);r&&r.click(),s.preventDefault()}},"aria-label":"Alterar foto do produto",title:"Clique para alterar a foto",children:[e.foto?t.jsx("img",{src:e.foto,alt:e.nome||"Foto do produto"}):t.jsx("span",{className:a.muted,children:"Thumbnail"}),t.jsx("input",{id:`foto-${e.id}`,type:"file",accept:"image/*",style:{display:"none"},onChange:s=>{const r=s.target.files?.[0];if(!r)return;const n=new FileReader;n.onload=()=>{const m=String(n.result||"");(async()=>{try{const i=await X(l,e.id,{foto:m});p(y=>y.map(W=>W.id===e.id?i:W))}catch(i){c(i?.message||"Falha ao atualizar foto")}})()},n.readAsDataURL(r),s.target.value=""}})]}),t.jsxs("div",{className:a.cardBody,children:[R===e.id?t.jsxs(t.Fragment,{children:[t.jsx("input",{className:a.inputInline,value:d.nome,onChange:s=>f(r=>({...r,nome:s.target.value})),placeholder:"Nome do produto"}),t.jsx("input",{className:a.inputInline,type:"number",min:"1",value:d.quantidade,onChange:s=>f(r=>({...r,quantidade:Math.max(1,Number(s.target.value||1))})),placeholder:"Quantidade"}),t.jsx("input",{className:a.inputInline,value:d.preco,onChange:s=>f(r=>({...r,preco:s.target.value})),placeholder:"Preço (R$)"}),t.jsx("textarea",{className:a.inputInline,rows:3,value:d.descricao,onChange:s=>f(r=>({...r,descricao:s.target.value})),placeholder:"Descrição do produto"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:a.cardTitle,children:e.nome}),t.jsx("div",{className:a.muted,children:e.descricao||"—"}),t.jsxs("div",{children:[t.jsx("strong",{children:"Quantidade:"})," ",e.quantidade,"  •  ",t.jsx("strong",{children:"Preço:"})," R$ ",Number(e.preco||0).toFixed(2),"  •  ",t.jsx("strong",{children:"Total:"})," R$ ",(Number(e.preco||0)*Number(e.quantidade||0)).toFixed(2)]})]}),t.jsxs("div",{className:a.cardActions,children:[t.jsx("div",{className:a.btnRow,children:R===e.id?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:`${a.btn} ${a.btnPrimary}`,onClick:()=>oe(e.id),children:"Salvar"}),t.jsx("button",{type:"button",className:a.btn,onClick:P,children:"Cancelar"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:a.btn,onClick:()=>ne(e.id),children:"Deletar"}),t.jsx("button",{type:"button",className:a.btn,onClick:()=>re(e),children:"Editar"})]})}),t.jsx("div",{className:a.time,children:e.updated_at?new Date(e.updated_at).toLocaleTimeString():""})]})]})]},e.id))})]})}export{xe as PanelLetsCoffe,xe as default};
